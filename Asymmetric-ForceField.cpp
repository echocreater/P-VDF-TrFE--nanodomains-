/*************************************
	PVDF Nanodomains NVT Sampling
		single threaded program
		written by GuanTong
			2024.3.30
**************************************/ 

#include <iostream>
#include <math.h>
#include <cstdlib>
#include <time.h>
#include <cmath>
#include <fstream>
#include <stdlib.h> 
#include <stdio.h>
using namespace std;

const int N=50; // params of the box 
double seta_is[N][N][N],seta_fs[N][N][N]; // structural mx [0,2.0*pi)

int Lop_rlx,Lop_spl,step_n; // loop number for relaxation and sampling; steps under one loop
int plot_cycle,strc_cycle; // cycle number for output energy & polarization, structure
double Tspl,amp,P; // sampling temperature, MC step length, Polarization Intensity
double kB=1.38e-23,nat=2.71828,pi=3.1415926536,NA=6.02e23;//Boltzmann para,nature para,pi 
double pi_2,n_norm_factor,agl_ff; // pi*2.0, 1/N^3, 6.0/pi; 
double delta_angle_y,delta_angle_z; // force field angle refinement in y & z direction
double total_energy; // total energy of the current dipole cofiguration



// force field params kcal/mol 

double x_energy_factor[8]={-1.02106,2.26425,1.11467,-1.08969,-0.21255,0.18769,0.01119,-0.00968}; // has been tested


double ac_ff[24][24]={
-0.320090 ,-5.450870 ,1.900600 ,3.330640 ,-4.066330 ,-10.198920 ,-0.573980 ,9.635410 ,9.373620 ,-6.833280 ,-3.127440 ,6.330640 ,-0.320090 ,-5.450870 ,1.900600 ,3.330640 ,-4.066330 ,-10.198920 ,-0.573980 ,9.635410 ,9.373620 ,-6.833280 ,-3.127440 ,6.330640 ,
-2.263300 ,3.688690 ,-4.907500 ,-1.854610 ,2.441450 ,-8.001060 ,6.837910 ,15.342060 ,-10.755210 ,-8.830070 ,10.822230 ,-2.520590 ,-2.263300 ,3.688690 ,-4.907500 ,-1.854610 ,2.441450 ,-8.001060 ,6.837910 ,15.342060 ,-10.755210 ,-8.830070 ,10.822230 ,-2.520590 ,
2.209770 ,-2.162210 ,1.311060 ,1.099080 ,-10.056350 ,10.888930 ,-0.407070 ,-13.111450 ,13.892520 ,18.317710 ,-17.269590 ,-4.712400 ,2.209770 ,-2.162210 ,1.311060 ,1.099080 ,-10.056350 ,10.888930 ,-0.407070 ,-13.111450 ,13.892520 ,18.317710 ,-17.269590 ,-4.712400 ,
-0.698790 ,-1.073600 ,0.237130 ,1.060930 ,6.065770 ,-8.265510 ,1.038980 ,6.365840 ,-5.470960 ,-1.046750 ,0.545570 ,1.241390 ,-0.698790 ,-1.073600 ,0.237130 ,1.060930 ,6.065770 ,-8.265510 ,1.038980 ,6.365840 ,-5.470960 ,-1.046750 ,0.545570 ,1.241390 ,
-6.979680 ,8.506590 ,-7.244980 ,-5.941330 ,0.246430 ,3.968940 ,1.226520 ,-8.309480 ,-2.391690 ,9.791350 ,10.497610 ,-3.370280 ,-6.979680 ,8.506590 ,-7.244980 ,-5.941330 ,0.246430 ,3.968940 ,1.226520 ,-8.309480 ,-2.391690 ,9.791350 ,10.497610 ,-3.370280 ,
4.460410 ,-9.937880 ,6.542420 ,3.858190 ,-1.733880 ,1.943900 ,6.434750 ,1.556090 ,-8.109560 ,-8.562620 ,5.764800 ,-2.216620 ,4.460410 ,-9.937880 ,6.542420 ,3.858190 ,-1.733880 ,1.943900 ,6.434750 ,1.556090 ,-8.109560 ,-8.562620 ,5.764800 ,-2.216620 ,
-3.926140 ,3.308110 ,-7.355050 ,8.714860 ,1.482490 ,0.437000 ,-2.869360 ,2.587100 ,0.032890 ,-1.340740 ,-6.701680 ,5.630520 ,-3.926140 ,3.308110 ,-7.355050 ,8.714860 ,1.482490 ,0.437000 ,-2.869360 ,2.587100 ,0.032890 ,-1.340740 ,-6.701680 ,5.630520 ,
6.251560 ,-2.814250 ,8.492850 ,-9.859510 ,2.112640 ,3.111640 ,-2.915480 ,1.155690 ,-2.215430 ,-0.861130 ,0.251820 ,-2.710400 ,6.251560 ,-2.814250 ,8.492850 ,-9.859510 ,2.112640 ,3.111640 ,-2.915480 ,1.155690 ,-2.215430 ,-0.861130 ,0.251820 ,-2.710400 ,
-9.401720 ,10.728530 ,-1.747930 ,1.425330 ,-1.047690 ,0.854420 ,2.278120 ,-3.625010 ,1.172060 ,0.685620 ,0.190960 ,-1.512690 ,-9.401720 ,10.728530 ,-1.747930 ,1.425330 ,-1.047690 ,0.854420 ,2.278120 ,-3.625010 ,1.172060 ,0.685620 ,0.190960 ,-1.512690 ,
8.769950 ,-10.194840 ,1.643450 ,4.632660 ,-1.422130 ,-9.162910 ,3.837290 ,1.493040 ,0.919300 ,-0.739020 ,-3.425890 ,3.649100 ,8.769950 ,-10.194840 ,1.643450 ,4.632660 ,-1.422130 ,-9.162910 ,3.837290 ,1.493040 ,0.919300 ,-0.739020 ,-3.425890 ,3.649100 ,
1.495600 ,2.444590 ,-2.783250 ,0.452620 ,8.161640 ,6.388180 ,-13.108120 ,1.585590 ,-9.455560 ,8.021640 ,-1.425080 ,-1.777850 ,1.495600 ,2.444590 ,-2.783250 ,0.452620 ,8.161640 ,6.388180 ,-13.108120 ,1.585590 ,-9.455560 ,8.021640 ,-1.425080 ,-1.777850 ,
0.402430 ,2.957140 ,3.911200 ,-6.918860 ,-2.184040 ,8.035390 ,-1.779560 ,-14.674880 ,13.008020 ,-8.602710 ,3.876690 ,1.969180 ,0.402430 ,2.957140 ,3.911200 ,-6.918860 ,-2.184040 ,8.035390 ,-1.779560 ,-14.674880 ,13.008020 ,-8.602710 ,3.876690 ,1.969180 ,
-0.320090 ,-5.450870 ,1.900600 ,3.330640 ,-4.066330 ,-10.198920 ,-0.573980 ,9.635410 ,9.373620 ,-6.833280 ,-3.127440 ,6.330640 ,-0.320090 ,-5.450870 ,1.900600 ,3.330640 ,-4.066330 ,-10.198920 ,-0.573980 ,9.635410 ,9.373620 ,-6.833280 ,-3.127440 ,6.330640 ,
-2.263300 ,3.688690 ,-4.907500 ,-1.854610 ,2.441450 ,-8.001060 ,6.837910 ,15.342060 ,-10.755210 ,-8.830070 ,10.822230 ,-2.520590 ,-2.263300 ,3.688690 ,-4.907500 ,-1.854610 ,2.441450 ,-8.001060 ,6.837910 ,15.342060 ,-10.755210 ,-8.830070 ,10.822230 ,-2.520590 ,
2.209770 ,-2.162210 ,1.311060 ,1.099080 ,-10.056350 ,10.888930 ,-0.407070 ,-13.111450 ,13.892520 ,18.317710 ,-17.269590 ,-4.712400 ,2.209770 ,-2.162210 ,1.311060 ,1.099080 ,-10.056350 ,10.888930 ,-0.407070 ,-13.111450 ,13.892520 ,18.317710 ,-17.269590 ,-4.712400 ,
-0.698790 ,-1.073600 ,0.237130 ,1.060930 ,6.065770 ,-8.265510 ,1.038980 ,6.365840 ,-5.470960 ,-1.046750 ,0.545570 ,1.241390 ,-0.698790 ,-1.073600 ,0.237130 ,1.060930 ,6.065770 ,-8.265510 ,1.038980 ,6.365840 ,-5.470960 ,-1.046750 ,0.545570 ,1.241390 ,
-6.979680 ,8.506590 ,-7.244980 ,-5.941330 ,0.246430 ,3.968940 ,1.226520 ,-8.309480 ,-2.391690 ,9.791350 ,10.497610 ,-3.370280 ,-6.979680 ,8.506590 ,-7.244980 ,-5.941330 ,0.246430 ,3.968940 ,1.226520 ,-8.309480 ,-2.391690 ,9.791350 ,10.497610 ,-3.370280 ,
4.460410 ,-9.937880 ,6.542420 ,3.858190 ,-1.733880 ,1.943900 ,6.434750 ,1.556090 ,-8.109560 ,-8.562620 ,5.764800 ,-2.216620 ,4.460410 ,-9.937880 ,6.542420 ,3.858190 ,-1.733880 ,1.943900 ,6.434750 ,1.556090 ,-8.109560 ,-8.562620 ,5.764800 ,-2.216620 ,
-3.926140 ,3.308110 ,-7.355050 ,8.714860 ,1.482490 ,0.437000 ,-2.869360 ,2.587100 ,0.032890 ,-1.340740 ,-6.701680 ,5.630520 ,-3.926140 ,3.308110 ,-7.355050 ,8.714860 ,1.482490 ,0.437000 ,-2.869360 ,2.587100 ,0.032890 ,-1.340740 ,-6.701680 ,5.630520 ,
6.251560 ,-2.814250 ,8.492850 ,-9.859510 ,2.112640 ,3.111640 ,-2.915480 ,1.155690 ,-2.215430 ,-0.861130 ,0.251820 ,-2.710400 ,6.251560 ,-2.814250 ,8.492850 ,-9.859510 ,2.112640 ,3.111640 ,-2.915480 ,1.155690 ,-2.215430 ,-0.861130 ,0.251820 ,-2.710400 ,
-9.401720 ,10.728530 ,-1.747930 ,1.425330 ,-1.047690 ,0.854420 ,2.278120 ,-3.625010 ,1.172060 ,0.685620 ,0.190960 ,-1.512690 ,-9.401720 ,10.728530 ,-1.747930 ,1.425330 ,-1.047690 ,0.854420 ,2.278120 ,-3.625010 ,1.172060 ,0.685620 ,0.190960 ,-1.512690 ,
8.769950 ,-10.194840 ,1.643450 ,4.632660 ,-1.422130 ,-9.162910 ,3.837290 ,1.493040 ,0.919300 ,-0.739020 ,-3.425890 ,3.649100 ,8.769950 ,-10.194840 ,1.643450 ,4.632660 ,-1.422130 ,-9.162910 ,3.837290 ,1.493040 ,0.919300 ,-0.739020 ,-3.425890 ,3.649100 ,
1.495600 ,2.444590 ,-2.783250 ,0.452620 ,8.161640 ,6.388180 ,-13.108120 ,1.585590 ,-9.455560 ,8.021640 ,-1.425080 ,-1.777850 ,1.495600 ,2.444590 ,-2.783250 ,0.452620 ,8.161640 ,6.388180 ,-13.108120 ,1.585590 ,-9.455560 ,8.021640 ,-1.425080 ,-1.777850 ,
0.402430 ,2.957140 ,3.911200 ,-6.918860 ,-2.184040 ,8.035390 ,-1.779560 ,-14.674880 ,13.008020 ,-8.602710 ,3.876690 ,1.969180 ,0.402430 ,2.957140 ,3.911200 ,-6.918860 ,-2.184040 ,8.035390 ,-1.779560 ,-14.674880 ,13.008020 ,-8.602710 ,3.876690 ,1.969180
};


double ad_ff[24][24]={
6.386990 ,6.066900 ,0.616030 ,2.516630 ,5.847270 ,1.780940 ,-8.417980 ,-8.991960 ,0.643450 ,10.017070 ,3.183790 ,0.056350 ,6.386990 ,6.066900 ,0.616030 ,2.516630 ,5.847270 ,1.780940 ,-8.417980 ,-8.991960 ,0.643450 ,10.017070 ,3.183790 ,0.056350 ,
4.085150 ,1.821850 ,5.510540 ,0.603040 ,-1.251570 ,1.189880 ,-6.811180 ,0.026730 ,15.368790 ,4.613580 ,-4.216490 ,6.605740 ,4.085150 ,1.821850 ,5.510540 ,0.603040 ,-1.251570 ,1.189880 ,-6.811180 ,0.026730 ,15.368790 ,4.613580 ,-4.216490 ,6.605740 ,
-3.483490 ,-1.273720 ,-3.435930 ,-2.124870 ,-1.025790 ,-11.082140 ,-0.193210 ,-0.600280 ,-13.711730 ,0.180790 ,18.498500 ,1.228910 ,-3.483490 ,-1.273720 ,-3.435930 ,-2.124870 ,-1.025790 ,-11.082140 ,-0.193210 ,-0.600280 ,-13.711730 ,0.180790 ,18.498500 ,1.228910 ,
0.253130 ,-0.445660 ,-1.519260 ,-1.282130 ,-0.221200 ,5.844570 ,-2.420940 ,-1.381960 ,4.983880 ,-0.487080 ,-1.533830 ,-0.988260 ,0.253130 ,-0.445660 ,-1.519260 ,-1.282130 ,-0.221200 ,5.844570 ,-2.420940 ,-1.381960 ,4.983880 ,-0.487080 ,-1.533830 ,-0.988260 ,
6.143770 ,-0.835910 ,7.670680 ,0.425700 ,-5.515630 ,-5.269200 ,-1.300260 ,-0.073740 ,-8.383220 ,-10.774910 ,-0.983560 ,9.514050 ,6.143770 ,-0.835910 ,7.670680 ,0.425700 ,-5.515630 ,-5.269200 ,-1.300260 ,-0.073740 ,-8.383220 ,-10.774910 ,-0.983560 ,9.514050 ,
-5.069470 ,-0.609060 ,-10.546940 ,-4.004520 ,-0.146330 ,-1.880210 ,0.063690 ,6.498440 ,8.054530 ,-0.055030 ,-8.617650 ,-2.852850 ,-5.069470 ,-0.609060 ,-10.546940 ,-4.004520 ,-0.146330 ,-1.880210 ,0.063690 ,6.498440 ,8.054530 ,-0.055030 ,-8.617650 ,-2.852850 ,
-2.344880 ,-6.271020 ,-2.962910 ,-10.317960 ,-1.603100 ,-0.120610 ,0.316390 ,-2.552970 ,0.034130 ,0.067020 ,-1.273720 ,-7.975400 ,-2.344880 ,-6.271020 ,-2.962910 ,-10.317960 ,-1.603100 ,-0.120610 ,0.316390 ,-2.552970 ,0.034130 ,0.067020 ,-1.273720 ,-7.975400 ,
-3.362570 ,2.888990 ,0.074740 ,8.567590 ,-1.291920 ,0.820720 ,3.932360 ,1.016880 ,2.172570 ,-0.042860 ,-0.903990 ,-0.652170 ,-3.362570 ,2.888990 ,0.074740 ,8.567590 ,-1.291920 ,0.820720 ,3.932360 ,1.016880 ,2.172570 ,-0.042860 ,-0.903990 ,-0.652170 ,
-1.121620 ,-10.523340 ,0.205190 ,-1.542740 ,-0.117410 ,-1.165100 ,-0.310680 ,1.967440 ,-1.657570 ,-0.485510 ,0.200110 ,0.391070 ,-1.121620 ,-10.523340 ,0.205190 ,-1.542740 ,-0.117410 ,-1.165100 ,-0.310680 ,1.967440 ,-1.657570 ,-0.485510 ,0.200110 ,0.391070 ,
0.168050 ,8.938000 ,-1.256840 ,0.386610 ,5.019270 ,3.597140 ,-5.565770 ,-1.728480 ,-0.235440 ,0.683860 ,-0.055160 ,-3.481050 ,0.168050 ,8.938000 ,-1.256840 ,0.386610 ,5.019270 ,3.597140 ,-5.565770 ,-1.728480 ,-0.235440 ,0.683860 ,-0.055160 ,-3.481050 ,
-1.529550 ,-0.033950 ,2.410640 ,-0.372610 ,0.080010 ,8.241650 ,14.629830 ,1.521710 ,3.107300 ,-6.348260 ,1.673380 ,0.248300 ,-1.529550 ,-0.033950 ,2.410640 ,-0.372610 ,0.080010 ,8.241650 ,14.629830 ,1.521710 ,3.107300 ,-6.348260 ,1.673380 ,0.248300 ,
-0.125510 ,0.276920 ,3.234060 ,7.145260 ,0.226400 ,-1.957640 ,6.077750 ,4.298190 ,-10.376690 ,2.631330 ,-5.971380 ,-2.094690 ,-0.125510 ,0.276920 ,3.234060 ,7.145260 ,0.226400 ,-1.957640 ,6.077750 ,4.298190 ,-10.376690 ,2.631330 ,-5.971380 ,-2.094690 ,
6.386990 ,6.066900 ,0.616030 ,2.516630 ,5.847270 ,1.780940 ,-8.417980 ,-8.991960 ,0.643450 ,10.017070 ,3.183790 ,0.056350 ,6.386990 ,6.066900 ,0.616030 ,2.516630 ,5.847270 ,1.780940 ,-8.417980 ,-8.991960 ,0.643450 ,10.017070 ,3.183790 ,0.056350 ,
4.085150 ,1.821850 ,5.510540 ,0.603040 ,-1.251570 ,1.189880 ,-6.811180 ,0.026730 ,15.368790 ,4.613580 ,-4.216490 ,6.605740 ,4.085150 ,1.821850 ,5.510540 ,0.603040 ,-1.251570 ,1.189880 ,-6.811180 ,0.026730 ,15.368790 ,4.613580 ,-4.216490 ,6.605740 ,
-3.483490 ,-1.273720 ,-3.435930 ,-2.124870 ,-1.025790 ,-11.082140 ,-0.193210 ,-0.600280 ,-13.711730 ,0.180790 ,18.498500 ,1.228910 ,-3.483490 ,-1.273720 ,-3.435930 ,-2.124870 ,-1.025790 ,-11.082140 ,-0.193210 ,-0.600280 ,-13.711730 ,0.180790 ,18.498500 ,1.228910 ,
0.253130 ,-0.445660 ,-1.519260 ,-1.282130 ,-0.221200 ,5.844570 ,-2.420940 ,-1.381960 ,4.983880 ,-0.487080 ,-1.533830 ,-0.988260 ,0.253130 ,-0.445660 ,-1.519260 ,-1.282130 ,-0.221200 ,5.844570 ,-2.420940 ,-1.381960 ,4.983880 ,-0.487080 ,-1.533830 ,-0.988260 ,
6.143770 ,-0.835910 ,7.670680 ,0.425700 ,-5.515630 ,-5.269200 ,-1.300260 ,-0.073740 ,-8.383220 ,-10.774910 ,-0.983560 ,9.514050 ,6.143770 ,-0.835910 ,7.670680 ,0.425700 ,-5.515630 ,-5.269200 ,-1.300260 ,-0.073740 ,-8.383220 ,-10.774910 ,-0.983560 ,9.514050 ,
-5.069470 ,-0.609060 ,-10.546940 ,-4.004520 ,-0.146330 ,-1.880210 ,0.063690 ,6.498440 ,8.054530 ,-0.055030 ,-8.617650 ,-2.852850 ,-5.069470 ,-0.609060 ,-10.546940 ,-4.004520 ,-0.146330 ,-1.880210 ,0.063690 ,6.498440 ,8.054530 ,-0.055030 ,-8.617650 ,-2.852850 ,
-2.344880 ,-6.271020 ,-2.962910 ,-10.317960 ,-1.603100 ,-0.120610 ,0.316390 ,-2.552970 ,0.034130 ,0.067020 ,-1.273720 ,-7.975400 ,-2.344880 ,-6.271020 ,-2.962910 ,-10.317960 ,-1.603100 ,-0.120610 ,0.316390 ,-2.552970 ,0.034130 ,0.067020 ,-1.273720 ,-7.975400 ,
-3.362570 ,2.888990 ,0.074740 ,8.567590 ,-1.291920 ,0.820720 ,3.932360 ,1.016880 ,2.172570 ,-0.042860 ,-0.903990 ,-0.652170 ,-3.362570 ,2.888990 ,0.074740 ,8.567590 ,-1.291920 ,0.820720 ,3.932360 ,1.016880 ,2.172570 ,-0.042860 ,-0.903990 ,-0.652170 ,
-1.121620 ,-10.523340 ,0.205190 ,-1.542740 ,-0.117410 ,-1.165100 ,-0.310680 ,1.967440 ,-1.657570 ,-0.485510 ,0.200110 ,0.391070 ,-1.121620 ,-10.523340 ,0.205190 ,-1.542740 ,-0.117410 ,-1.165100 ,-0.310680 ,1.967440 ,-1.657570 ,-0.485510 ,0.200110 ,0.391070 ,
0.168050 ,8.938000 ,-1.256840 ,0.386610 ,5.019270 ,3.597140 ,-5.565770 ,-1.728480 ,-0.235440 ,0.683860 ,-0.055160 ,-3.481050 ,0.168050 ,8.938000 ,-1.256840 ,0.386610 ,5.019270 ,3.597140 ,-5.565770 ,-1.728480 ,-0.235440 ,0.683860 ,-0.055160 ,-3.481050 ,
-1.529550 ,-0.033950 ,2.410640 ,-0.372610 ,0.080010 ,8.241650 ,14.629830 ,1.521710 ,3.107300 ,-6.348260 ,1.673380 ,0.248300 ,-1.529550 ,-0.033950 ,2.410640 ,-0.372610 ,0.080010 ,8.241650 ,14.629830 ,1.521710 ,3.107300 ,-6.348260 ,1.673380 ,0.248300 ,
-0.125510 ,0.276920 ,3.234060 ,7.145260 ,0.226400 ,-1.957640 ,6.077750 ,4.298190 ,-10.376690 ,2.631330 ,-5.971380 ,-2.094690 ,-0.125510 ,0.276920 ,3.234060 ,7.145260 ,0.226400 ,-1.957640 ,6.077750 ,4.298190 ,-10.376690 ,2.631330 ,-5.971380 ,-2.094690
};


double bc_ff[24][24]={
0.269140 ,3.994790 ,1.277360 ,-1.651290 ,5.614520 ,9.559800 ,-8.088040 ,-9.821030 ,2.404050 ,-2.611940 ,-1.059430 ,0.112070 ,0.269140 ,3.994790 ,1.277360 ,-1.651290 ,5.614520 ,9.559800 ,-8.088040 ,-9.821030 ,2.404050 ,-2.611940 ,-1.059430 ,0.112070 ,
-0.050950 ,-1.456080 ,3.177960 ,1.679350 ,1.548190 ,-0.639120 ,-8.662020 ,-0.185620 ,11.777670 ,-9.445220 ,-4.186870 ,6.442710 ,-0.050950 ,-1.456080 ,3.177960 ,1.679350 ,1.548190 ,-0.639120 ,-8.662020 ,-0.185620 ,11.777670 ,-9.445220 ,-4.186870 ,6.442710 ,
-2.314250 ,2.232610 ,-1.729540 ,-0.175260 ,3.989640 ,-8.640180 ,-1.824110 ,15.156440 ,1.022460 ,-18.275290 ,6.635360 ,3.922120 ,-2.314250 ,2.232610 ,-1.729540 ,-0.175260 ,3.989640 ,-8.640180 ,-1.824110 ,15.156440 ,1.022460 ,-18.275290 ,6.635360 ,3.922120 ,
-0.104480 ,0.070400 ,-0.418480 ,0.923820 ,-6.066710 ,2.248750 ,-2.231180 ,2.044990 ,14.914980 ,0.042420 ,-10.634230 ,-0.790280 ,-0.104480 ,0.070400 ,-0.418480 ,0.923820 ,-6.066710 ,2.248750 ,-2.231180 ,2.044990 ,14.914980 ,0.042420 ,-10.634230 ,-0.790280 ,
-0.803270 ,-1.003200 ,-0.181350 ,1.984750 ,-0.000940 ,-6.016760 ,-1.192200 ,8.410830 ,9.444020 ,-1.004330 ,-10.088660 ,0.451110 ,-0.803270 ,-1.003200 ,-0.181350 ,1.984750 ,-0.000940 ,-6.016760 ,-1.192200 ,8.410830 ,9.444020 ,-1.004330 ,-10.088660 ,0.451110 ,
-7.782950 ,7.503390 ,-7.426330 ,-3.956580 ,0.245490 ,-2.047820 ,0.034320 ,0.101350 ,7.052330 ,8.787020 ,0.408950 ,-2.919170 ,-7.782950 ,7.503390 ,-7.426330 ,-3.956580 ,0.245490 ,-2.047820 ,0.034320 ,0.101350 ,7.052330 ,8.787020 ,0.408950 ,-2.919170 ,
-3.322540 ,-2.434490 ,-0.883910 ,-0.098390 ,-1.488390 ,-0.103920 ,6.469070 ,1.657440 ,-1.057230 ,0.224400 ,6.173750 ,-5.135790 ,-3.322540 ,-2.434490 ,-0.883910 ,-0.098390 ,-1.488390 ,-0.103920 ,6.469070 ,1.657440 ,-1.057230 ,0.224400 ,6.173750 ,-5.135790 ,
-7.248680 ,0.873620 ,-8.238960 ,8.616470 ,-0.005900 ,0.333080 ,3.599710 ,4.244540 ,-1.024340 ,-1.116340 ,-0.527930 ,0.494730 ,-7.248680 ,0.873620 ,-8.238960 ,8.616470 ,-0.005900 ,0.333080 ,3.599710 ,4.244540 ,-1.024340 ,-1.116340 ,-0.527930 ,0.494730 ,
-0.997120 ,-1.940630 ,0.253890 ,-1.243040 ,2.106740 ,3.444720 ,0.684230 ,5.400230 ,-3.239770 ,-1.977470 ,-0.276110 ,-2.215670 ,-0.997120 ,-1.940630 ,0.253890 ,-1.243040 ,2.106740 ,3.444720 ,0.684230 ,5.400230 ,-3.239770 ,-1.977470 ,-0.276110 ,-2.215670 ,
-10.398840 ,8.787900 ,-1.494040 ,0.182290 ,1.059050 ,4.299140 ,2.962350 ,1.775220 ,-2.067710 ,-1.291850 ,-0.085150 ,-3.728360 ,-10.398840 ,8.787900 ,-1.494040 ,0.182290 ,1.059050 ,4.299140 ,2.962350 ,1.775220 ,-2.067710 ,-1.291850 ,-0.085150 ,-3.728360 ,
-1.628890 ,-1.406940 ,0.149410 ,4.814950 ,-0.363080 ,-4.863770 ,6.799640 ,3.268260 ,-1.148410 ,-2.030870 ,-3.511040 ,-0.079260 ,-1.628890 ,-1.406940 ,0.149410 ,4.814950 ,-0.363080 ,-4.863770 ,6.799640 ,3.268260 ,-1.148410 ,-2.030870 ,-3.511040 ,-0.079260 ,
-0.133290 ,1.037650 ,-2.633840 ,5.267570 ,7.798560 ,1.524410 ,-6.308480 ,4.853850 ,-10.603970 ,5.990770 ,-4.936120 ,-1.857110 ,-0.133290 ,1.037650 ,-2.633840 ,5.267570 ,7.798560 ,1.524410 ,-6.308480 ,4.853850 ,-10.603970 ,5.990770 ,-4.936120 ,-1.857110 ,
0.269140 ,3.994790 ,1.277360 ,-1.651290 ,5.614520 ,9.559800 ,-8.088040 ,-9.821030 ,2.404050 ,-2.611940 ,-1.059430 ,0.112070 ,0.269140 ,3.994790 ,1.277360 ,-1.651290 ,5.614520 ,9.559800 ,-8.088040 ,-9.821030 ,2.404050 ,-2.611940 ,-1.059430 ,0.112070 ,
-0.050950 ,-1.456080 ,3.177960 ,1.679350 ,1.548190 ,-0.639120 ,-8.662020 ,-0.185620 ,11.777670 ,-9.445220 ,-4.186870 ,6.442710 ,-0.050950 ,-1.456080 ,3.177960 ,1.679350 ,1.548190 ,-0.639120 ,-8.662020 ,-0.185620 ,11.777670 ,-9.445220 ,-4.186870 ,6.442710 ,
-2.314250 ,2.232610 ,-1.729540 ,-0.175260 ,3.989640 ,-8.640180 ,-1.824110 ,15.156440 ,1.022460 ,-18.275290 ,6.635360 ,3.922120 ,-2.314250 ,2.232610 ,-1.729540 ,-0.175260 ,3.989640 ,-8.640180 ,-1.824110 ,15.156440 ,1.022460 ,-18.275290 ,6.635360 ,3.922120 ,
-0.104480 ,0.070400 ,-0.418480 ,0.923820 ,-6.066710 ,2.248750 ,-2.231180 ,2.044990 ,14.914980 ,0.042420 ,-10.634230 ,-0.790280 ,-0.104480 ,0.070400 ,-0.418480 ,0.923820 ,-6.066710 ,2.248750 ,-2.231180 ,2.044990 ,14.914980 ,0.042420 ,-10.634230 ,-0.790280 ,
-0.803270 ,-1.003200 ,-0.181350 ,1.984750 ,-0.000940 ,-6.016760 ,-1.192200 ,8.410830 ,9.444020 ,-1.004330 ,-10.088660 ,0.451110 ,-0.803270 ,-1.003200 ,-0.181350 ,1.984750 ,-0.000940 ,-6.016760 ,-1.192200 ,8.410830 ,9.444020 ,-1.004330 ,-10.088660 ,0.451110 ,
-7.782950 ,7.503390 ,-7.426330 ,-3.956580 ,0.245490 ,-2.047820 ,0.034320 ,0.101350 ,7.052330 ,8.787020 ,0.408950 ,-2.919170 ,-7.782950 ,7.503390 ,-7.426330 ,-3.956580 ,0.245490 ,-2.047820 ,0.034320 ,0.101350 ,7.052330 ,8.787020 ,0.408950 ,-2.919170 ,
-3.322540 ,-2.434490 ,-0.883910 ,-0.098390 ,-1.488390 ,-0.103920 ,6.469070 ,1.657440 ,-1.057230 ,0.224400 ,6.173750 ,-5.135790 ,-3.322540 ,-2.434490 ,-0.883910 ,-0.098390 ,-1.488390 ,-0.103920 ,6.469070 ,1.657440 ,-1.057230 ,0.224400 ,6.173750 ,-5.135790 ,
-7.248680 ,0.873620 ,-8.238960 ,8.616470 ,-0.005900 ,0.333080 ,3.599710 ,4.244540 ,-1.024340 ,-1.116340 ,-0.527930 ,0.494730 ,-7.248680 ,0.873620 ,-8.238960 ,8.616470 ,-0.005900 ,0.333080 ,3.599710 ,4.244540 ,-1.024340 ,-1.116340 ,-0.527930 ,0.494730 ,
-0.997120 ,-1.940630 ,0.253890 ,-1.243040 ,2.106740 ,3.444720 ,0.684230 ,5.400230 ,-3.239770 ,-1.977470 ,-0.276110 ,-2.215670 ,-0.997120 ,-1.940630 ,0.253890 ,-1.243040 ,2.106740 ,3.444720 ,0.684230 ,5.400230 ,-3.239770 ,-1.977470 ,-0.276110 ,-2.215670 ,
-10.398840 ,8.787900 ,-1.494040 ,0.182290 ,1.059050 ,4.299140 ,2.962350 ,1.775220 ,-2.067710 ,-1.291850 ,-0.085150 ,-3.728360 ,-10.398840 ,8.787900 ,-1.494040 ,0.182290 ,1.059050 ,4.299140 ,2.962350 ,1.775220 ,-2.067710 ,-1.291850 ,-0.085150 ,-3.728360 ,
-1.628890 ,-1.406940 ,0.149410 ,4.814950 ,-0.363080 ,-4.863770 ,6.799640 ,3.268260 ,-1.148410 ,-2.030870 ,-3.511040 ,-0.079260 ,-1.628890 ,-1.406940 ,0.149410 ,4.814950 ,-0.363080 ,-4.863770 ,6.799640 ,3.268260 ,-1.148410 ,-2.030870 ,-3.511040 ,-0.079260 ,
-0.133290 ,1.037650 ,-2.633840 ,5.267570 ,7.798560 ,1.524410 ,-6.308480 ,4.853850 ,-10.603970 ,5.990770 ,-4.936120 ,-1.857110 ,-0.133290 ,1.037650 ,-2.633840 ,5.267570 ,7.798560 ,1.524410 ,-6.308480 ,4.853850 ,-10.603970 ,5.990770 ,-4.936120 ,-1.857110
};


double bd_ff[24][24]={
8.911830 ,9.180970 ,13.175760 ,14.453120 ,12.801830 ,18.416350 ,27.976150 ,19.888110 ,10.067080 ,12.471130 ,9.859190 ,8.799760 ,8.911830 ,9.180970 ,13.175760 ,14.453120 ,12.801830 ,18.416350 ,27.976150 ,19.888110 ,10.067080 ,12.471130 ,9.859190 ,8.799760 ,
15.298820 ,15.247870 ,13.791790 ,16.969750 ,18.649100 ,20.197290 ,19.558170 ,10.896150 ,10.710530 ,22.488200 ,13.042980 ,8.856110 ,15.298820 ,15.247870 ,13.791790 ,16.969750 ,18.649100 ,20.197290 ,19.558170 ,10.896150 ,10.710530 ,22.488200 ,13.042980 ,8.856110 ,
19.383970 ,17.069720 ,19.302330 ,17.572790 ,17.397530 ,21.387170 ,12.746990 ,10.922880 ,26.079320 ,27.101780 ,8.826490 ,15.461850 ,19.383970 ,17.069720 ,19.302330 ,17.572790 ,17.397530 ,21.387170 ,12.746990 ,10.922880 ,26.079320 ,27.101780 ,8.826490 ,15.461850 ,
15.900480 ,15.796000 ,15.866400 ,15.447920 ,16.371740 ,10.305030 ,12.553780 ,10.322600 ,12.367590 ,27.282570 ,27.324990 ,16.690760 ,15.900480 ,15.796000 ,15.866400 ,15.447920 ,16.371740 ,10.305030 ,12.553780 ,10.322600 ,12.367590 ,27.282570 ,27.324990 ,16.690760 ,
16.153610 ,15.350340 ,14.347140 ,14.165790 ,16.150540 ,16.149600 ,10.132840 ,8.940640 ,17.351470 ,26.795490 ,25.791160 ,15.702500 ,16.153610 ,15.350340 ,14.347140 ,14.165790 ,16.150540 ,16.149600 ,10.132840 ,8.940640 ,17.351470 ,26.795490 ,25.791160 ,15.702500 ,
22.297380 ,14.514430 ,22.017820 ,14.591490 ,10.634910 ,10.880400 ,8.832580 ,8.866900 ,8.968250 ,16.020580 ,24.807600 ,25.216550 ,22.297380 ,14.514430 ,22.017820 ,14.591490 ,10.634910 ,10.880400 ,8.832580 ,8.866900 ,8.968250 ,16.020580 ,24.807600 ,25.216550 ,
17.227910 ,13.905370 ,11.470880 ,10.586970 ,10.488580 ,9.000190 ,8.896270 ,15.365340 ,17.022780 ,15.965550 ,16.189950 ,22.363700 ,17.227910 ,13.905370 ,11.470880 ,10.586970 ,10.488580 ,9.000190 ,8.896270 ,15.365340 ,17.022780 ,15.965550 ,16.189950 ,22.363700 ,
14.883030 ,7.634350 ,8.507970 ,0.269010 ,8.885480 ,8.879580 ,9.212660 ,12.812370 ,17.056910 ,16.032570 ,14.916230 ,14.388300 ,14.883030 ,7.634350 ,8.507970 ,0.269010 ,8.885480 ,8.879580 ,9.212660 ,12.812370 ,17.056910 ,16.032570 ,14.916230 ,14.388300 ,
11.520460 ,10.523340 ,8.582710 ,8.836600 ,7.593560 ,9.700300 ,13.145020 ,13.829250 ,19.229480 ,15.989710 ,14.012240 ,13.736130 ,11.520460 ,10.523340 ,8.582710 ,8.836600 ,7.593560 ,9.700300 ,13.145020 ,13.829250 ,19.229480 ,15.989710 ,14.012240 ,13.736130 ,
10.398840 ,0.000000 ,8.787900 ,7.293860 ,7.476150 ,8.535200 ,12.834340 ,15.796690 ,17.571910 ,15.504200 ,14.212350 ,14.127200 ,10.398840 ,0.000000 ,8.787900 ,7.293860 ,7.476150 ,8.535200 ,12.834340 ,15.796690 ,17.571910 ,15.504200 ,14.212350 ,14.127200 ,
10.566890 ,8.938000 ,7.531060 ,7.680470 ,12.495420 ,12.132340 ,7.268570 ,14.068210 ,17.336470 ,16.188060 ,14.157190 ,10.646150 ,10.566890 ,8.938000 ,7.531060 ,7.680470 ,12.495420 ,12.132340 ,7.268570 ,14.068210 ,17.336470 ,16.188060 ,14.157190 ,10.646150 ,
9.037340 ,8.904050 ,9.941700 ,7.307860 ,12.575430 ,20.373990 ,21.898400 ,15.589920 ,20.443770 ,9.839800 ,15.830570 ,10.894450 ,9.037340 ,8.904050 ,9.941700 ,7.307860 ,12.575430 ,20.373990 ,21.898400 ,15.589920 ,20.443770 ,9.839800 ,15.830570 ,10.894450 ,
8.911830 ,9.180970 ,13.175760 ,14.453120 ,12.801830 ,18.416350 ,27.976150 ,19.888110 ,10.067080 ,12.471130 ,9.859190 ,8.799760 ,8.911830 ,9.180970 ,13.175760 ,14.453120 ,12.801830 ,18.416350 ,27.976150 ,19.888110 ,10.067080 ,12.471130 ,9.859190 ,8.799760 ,
15.298820 ,15.247870 ,13.791790 ,16.969750 ,18.649100 ,20.197290 ,19.558170 ,10.896150 ,10.710530 ,22.488200 ,13.042980 ,8.856110 ,15.298820 ,15.247870 ,13.791790 ,16.969750 ,18.649100 ,20.197290 ,19.558170 ,10.896150 ,10.710530 ,22.488200 ,13.042980 ,8.856110 ,
19.383970 ,17.069720 ,19.302330 ,17.572790 ,17.397530 ,21.387170 ,12.746990 ,10.922880 ,26.079320 ,27.101780 ,8.826490 ,15.461850 ,19.383970 ,17.069720 ,19.302330 ,17.572790 ,17.397530 ,21.387170 ,12.746990 ,10.922880 ,26.079320 ,27.101780 ,8.826490 ,15.461850 ,
15.900480 ,15.796000 ,15.866400 ,15.447920 ,16.371740 ,10.305030 ,12.553780 ,10.322600 ,12.367590 ,27.282570 ,27.324990 ,16.690760 ,15.900480 ,15.796000 ,15.866400 ,15.447920 ,16.371740 ,10.305030 ,12.553780 ,10.322600 ,12.367590 ,27.282570 ,27.324990 ,16.690760 ,
16.153610 ,15.350340 ,14.347140 ,14.165790 ,16.150540 ,16.149600 ,10.132840 ,8.940640 ,17.351470 ,26.795490 ,25.791160 ,15.702500 ,16.153610 ,15.350340 ,14.347140 ,14.165790 ,16.150540 ,16.149600 ,10.132840 ,8.940640 ,17.351470 ,26.795490 ,25.791160 ,15.702500 ,
22.297380 ,14.514430 ,22.017820 ,14.591490 ,10.634910 ,10.880400 ,8.832580 ,8.866900 ,8.968250 ,16.020580 ,24.807600 ,25.216550 ,22.297380 ,14.514430 ,22.017820 ,14.591490 ,10.634910 ,10.880400 ,8.832580 ,8.866900 ,8.968250 ,16.020580 ,24.807600 ,25.216550 ,
17.227910 ,13.905370 ,11.470880 ,10.586970 ,10.488580 ,9.000190 ,8.896270 ,15.365340 ,17.022780 ,15.965550 ,16.189950 ,22.363700 ,17.227910 ,13.905370 ,11.470880 ,10.586970 ,10.488580 ,9.000190 ,8.896270 ,15.365340 ,17.022780 ,15.965550 ,16.189950 ,22.363700 ,
14.883030 ,7.634350 ,8.507970 ,0.269010 ,8.885480 ,8.879580 ,9.212660 ,12.812370 ,17.056910 ,16.032570 ,14.916230 ,14.388300 ,14.883030 ,7.634350 ,8.507970 ,0.269010 ,8.885480 ,8.879580 ,9.212660 ,12.812370 ,17.056910 ,16.032570 ,14.916230 ,14.388300 ,
11.520460 ,10.523340 ,8.582710 ,8.836600 ,7.593560 ,9.700300 ,13.145020 ,13.829250 ,19.229480 ,15.989710 ,14.012240 ,13.736130 ,11.520460 ,10.523340 ,8.582710 ,8.836600 ,7.593560 ,9.700300 ,13.145020 ,13.829250 ,19.229480 ,15.989710 ,14.012240 ,13.736130 ,
10.398840 ,0.000000 ,8.787900 ,7.293860 ,7.476150 ,8.535200 ,12.834340 ,15.796690 ,17.571910 ,15.504200 ,14.212350 ,14.127200 ,10.398840 ,0.000000 ,8.787900 ,7.293860 ,7.476150 ,8.535200 ,12.834340 ,15.796690 ,17.571910 ,15.504200 ,14.212350 ,14.127200 ,
10.566890 ,8.938000 ,7.531060 ,7.680470 ,12.495420 ,12.132340 ,7.268570 ,14.068210 ,17.336470 ,16.188060 ,14.157190 ,10.646150 ,10.566890 ,8.938000 ,7.531060 ,7.680470 ,12.495420 ,12.132340 ,7.268570 ,14.068210 ,17.336470 ,16.188060 ,14.157190 ,10.646150 ,
9.037340 ,8.904050 ,9.941700 ,7.307860 ,12.575430 ,20.373990 ,21.898400 ,15.589920 ,20.443770 ,9.839800 ,15.830570 ,10.894450 ,9.037340 ,8.904050 ,9.941700 ,7.307860 ,12.575430 ,20.373990 ,21.898400 ,15.589920 ,20.443770 ,9.839800 ,15.830570 ,10.894450
};


FILE *fp_plot,*fp_strc,*fp_acc,*fp_sys; // file pointers


//fuction names
double calc_is_energy();
int sr(int i);
double calc_cpl_energy(double seta_1,double seta_2);
double calc_y_energy(double seta1,double seta2);
double calc_z_energy(double seta1,double seta2);


int main()
{
	srand((unsigned)time(NULL));

	
	/*** initialization ***/
	
		
	//params initialize//
	
	//calculation params
	pi_2=pi*2.0;
	n_norm_factor=1.0/double(pow(N,3.0));
	agl_ff=6.0/pi;
	
	//angle refinement
	delta_angle_y=0.8325;
	delta_angle_z=5.5449;

	
	//structure initialize//
			
	//start from an input snapshot
	fp_strc=fopen("input.txt","r+");	
	int temp;	
	for(int i=0;i<N;i++)
	{
		fscanf(fp_strc,"%d",&temp);
		for(int j=0;j<N;j++)
		{
			for(int k=0;k<N;k++)
			{
				fscanf(fp_strc,"%lf",&seta_is[i][j][k]);
				seta_fs[i][j][k]=seta_is[i][j][k];
			}
		}
	}	
	fclose(fp_strc);
	
	//starting structure output check	
	fp_strc=fopen("input.chk","w+");
	for(int i=0;i<N;i++)
	{
		fprintf(fp_strc,"%d %s",i,"\n");
		for(int j=0;j<N;j++)
		{
			for(int k=0;k<N;k++)
			{
				fprintf(fp_strc,"%lf\t",seta_fs[i][j][k]);
			}
			fprintf(fp_strc,"%s","\n");
		}
	}	
	fclose(fp_strc);
	
	
    /*** calculate energy ***/
	total_energy=calc_is_energy(); 
    fp_strc=fopen("ene.out","w+");
    fprintf(fp_strc,"%lf\n",total_energy);
    fclose(fp_strc);
	


	system("pause");
	return 0;

}




double calc_is_energy()
{
	double is_energy=0.0;
	for(int i=0;i<N;i++)
	{
		for(int j=0;j<N;j++)
		{
			for(int k=0;k<N;k++)
			{
			    is_energy=is_energy+calc_cpl_energy(seta_is[i][j][k],seta_is[sr(i+1)][j][k])+calc_y_energy(seta_is[i][j][k],seta_is[i][sr(j+1)][k])+calc_z_energy(seta_is[i][j][k],seta_is[i][j][sr(k+1)]);
			}
		}
	}
	return is_energy;
} 


int sr(int i) // PBC order 
{
	if(i<0)
	{
		return N-1;
	}
	else if(i>N-1)
	{
		return 0;
	}
	else
	{
		return i;
	}
}


double calc_cpl_energy(double seta_1,double seta_2)//x_coupling energy (intrachain interaction) kcal/mol
{
	double agl,cpl_energy=0.0;
	agl=seta_1-seta_2;
	
	// keep the delta angle in (-pi,pi)
	if(agl<-pi)
	{
		agl=agl+pi_2;
	}
	else if(agl>pi)
	{
		agl=agl-pi_2;
	}
	else;
	
	for(int n=0;n<8;n++)
	{
		cpl_energy=cpl_energy+x_energy_factor[n]*pow(agl,n+1);
	} 

	return cpl_energy;
}



double calc_y_energy(double seta1,double seta2) // seta1:i,j,k; seta2:i,j+1,k 
{
	double alpha,beta,n,m,x,y;
	int n0,m0;
	
	alpha=seta1+delta_angle_y;
	beta=seta2+delta_angle_y;
	
	n=agl_ff*alpha;
	m=agl_ff*beta;
	
	n0=int(n);
	m0=int(m);
	
	x=n-n0;
	y=m-m0;
	
	return 0.25*(ac_ff[n0][m0]*x*y+ad_ff[n0][m0]*x+bc_ff[n0][m0]*y+bd_ff[n0][m0]);
}




double calc_z_energy(double seta1,double seta2) // seta1:i,j,k; seta2:i,j,k+1
{
	double alpha,beta,n,m,x,y;
	int n0,m0;
	
	alpha=seta1+delta_angle_z;
	beta=seta2+delta_angle_z;
	
	n=agl_ff*alpha;
	m=agl_ff*beta;
	
	n0=int(n);
	m0=int(m);
	
	x=n-n0;
	y=m-m0;
	
	return 0.25*(ac_ff[n0][m0]*x*y+ad_ff[n0][m0]*x+bc_ff[n0][m0]*y+bd_ff[n0][m0]); 		
}

